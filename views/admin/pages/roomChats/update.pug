extends ../../layouts/admin

include ../../mixins/boxGoBack
include ../../mixins/boxTitle

block main
  +boxGoBack(`/${admin}/roomChats`)

  +boxTitle(pageTitle)

  form(
    method="POST"
    action=`/${admin}/roomChats/update/${roomChat.id}?_method=PATCH`
    enctype="multipart/form-data"
  )
    .mb-3
      label.form-label Title
      input(
        class="form-control"
        name="title"
        value=roomChat.title 
        required
      )
    .mb-3
      label.form-label Image
      .w-25.mb-1
        img(
          class="img-thumbnail"
          src=roomChat.avatar
        )
      input(
        class="form-control"
        type="file"
        name="avatar"
        accept="image/*"
        value=roomChat.avatar
      )
    .mb-3
      label.form-label Type
      select(
        class="form-select"
        disabled
      )
        option(value="group" selected=(roomChat.type === "group")) Group
        option(value="friend" selected=(roomChat.type === "friend")) Friend
    .mb-3
      label.form-label Status
      select(
        class="form-select"
        name="status"
        required
      )
        option(value="active" selected=(roomChat.status === "active")) Active
        option(value="inactive" selected=(roomChat.status === "inactive")) Inactive
    
    .d-flex.justify-content-center.mb-3
      button.btn.btn-primary Update
      
  .mb-3
    label.form-label List of users
    .row
      each item in users
        .col-3
          .card
            img(
              class="card-img-top"
              style="aspect-ratio: 4/3"
              src=item.user.avatar
            )
            .card-body
              h5.card-title #{item.user.fullName}

              form(
                method="POST"
                action=`/${admin}/roomChats/changeUserRole`
                roomChatId=roomChat.id
                userId=item.user.id
                form-change-room-chat-user-role
              )
                .mb-3
                  label.form-label Role
                  select.form-select
                    option(value="superAdmin" selected=(item.role === "superAdmin")) Owner 
                    option(value="admin" selected=(item.role === "admin")) Admin
                    option(value="user" selected=(item.role === "user")) User
              
              p.card-text #{item.user.phone}
              .d-flex
                a(
                  class="btn btn-primary me-1"
                  href=`/${admin}/users/detail/${item.user.id}`
                ) Detail

                form(
                  method="POST"
                  action=`/${admin}/roomChats/deleteUser`
                  roomChatId=roomChat.id
                  userId=item.user.id
                  form-delete-room-chat-user
                )
                  button.btn.btn-danger Delete

  .mb-3
    label.form-label List of user requests
    .row
      each user in userRequests
        .col-3
          .card
            img(
              class="card-img-top"
              style="aspect-ratio: 4/3"
              src=user.avatar
            )
            .card-body
              h5.card-title #{user.fullName}
              p.card-text #{user.phone}
              a(
                class="btn btn-primary"
                href=`/${admin}/users/detail/${user.id}`
              ) Detail

              .mt-1.d-flex
                form(
                  method="POST"
                  action=`/${admin}/roomChats/acceptUser`
                  roomChatId=roomChat.id
                  userId=user.id
                  form-accept-room-chat-user
                )
                  button.btn.btn-primary Accept

                form(
                  class="ms-1"
                  method="POST"
                  action=`/${admin}/roomChats/deleteUserRequest`
                  roomChatId=roomChat.id
                  userId=user.id
                  form-delete-room-chat-user-request
                )
                  button.btn.btn-danger Delete